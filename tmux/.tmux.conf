set -g default-terminal "xterm-256color"
set-option -g default-shell "$SHELL"

set-window-option -g xterm-keys on
set-window-option -g mode-keys vi
set-window-option -g status-keys vi
set-option -g allow-rename off
set -s escape-time 0
set -g history-limit 1048576

# Try to allow working with varying screen size connections
setw -g aggressive-resize on

#set-window-option -g utf8 on
#set fillchars+=stl:\ ,stlnc:\ 
#set -g pane-border-status top
#set -g pane-border-format 'â”€'

unbind C-b
set -g prefix C-a

#set -g status-bg colour24
#setw -g window-status-current-bg colour24

bind S choose-tree

bind -n M-t new-window -a -n 'sh'
bind -n M-h prev
bind -n M-l next
#bind -n S-M-h  swap-window -t -1
#bind -n S-C-right swap-window -t +1

# smart pane switching with awareness of vim splits
bind -n C-h run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-h) || tmux select-pane -L"
bind -n C-j run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-j) || tmux select-pane -D"
bind -n C-k run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-k) || tmux select-pane -U"
bind -n C-l run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-l) || tmux select-pane -R"
#bind -n C-\ run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys 'C-\\') || tmux select-pane -l"

bind -n M-k \
  set -qg status-bg default \; \
  set -qg status-fg colour0 \; \
  set -qg status-left-bg default \; \
  set -qg status-left-fg colour0 \; \
  set -qg status-right-bg default \; \
  set -qg status-right-fg colour0 \; \
  set -qg window-status-separator-bg default \; \
  set -qg window-status-separator-fg colour0 \; \
  set -qg window-status-current-bg default \; \
  set -qg window-status-current-bg default \; \
  set -qg window-status-current-fg colour24 \; \
  set -qg window-status-bg default \; \
  set -qg window-status-fg colour236 \; \
  set -qg status-right 'S:#S W:#I P:#P #[fg=colour124,bg=colour190]#{?client_prefix,#[reverse](^a)#[noreverse],}#[fg=colour240,bg=default] %Y-%m-%d #[fg=colour240,bg=default] %H:%M.%S #[fg=colour39,bg=colour233]#{battery_status_fg}#{battery_percentage}' \; \
  run-shell /Users/owl/.config/termcfg/tmux/tmux-battery/battery.tmux \; \
  unbind -n M-i \; \
  unbind -n M-o \; \
  unbind -n M-p \; \
  unbind -n M-n \; \
  unbind -n M-h \; \
  unbind -n M-l \; \
  unbind -n M-t \; \
  unbind -n C-h \; \
  unbind -n C-j \; \
  unbind -n C-k \; \
  unbind -n C-l \; \
  unbind C-v \; \
  set -qg prefix C-b
bind -n M-j \
  set -qg status-bg default \; \
  set -qg status-fg colour248 \; \
  set -qg status-left-bg colour233 \; \
  set -qg status-left-fg colour39 \; \
  set -qg status-right-bg default \; \
  set -qg status-right-fg colour238 \; \
  set -qg window-status-separator-bg colour235 \; \
  set -qg window-status-separator-fg colour235 \; \
  set -qg window-status-current-bg colour254 \; \
  set -qg window-status-current-bg colour24 \; \
  set -qg window-status-current-fg colour254 \; \
  set -qg window-status-bg colour234 \; \
  set -qg window-status-fg colour248 \; \
  set -qg status-right 'S:#S W:#I P:#P #[fg=colour124,bg=colour190]#{?client_prefix,#[reverse](^a)#[noreverse],}#[fg=colour254,bg=colour235] %Y-%m-%d #[fg=colour253,bg=colour236] %H:%M.%S #[fg=colour39,bg=colour233]#{battery_status_fg}#{battery_percentage}' \; \
  run-shell /Users/owl/.config/termcfg/tmux/tmux-battery/battery.tmux \; \
  bind -n M-i swap-pane -t -1 \; \
  bind -n M-o swap-pane -t +1 \; \
  bind -n M-p swap-window -t -1 \; \
  bind -n M-n swap-window -t +1 \; \
  bind -n M-h prev \; \
  bind -n M-l next \; \
  bind -n M-t new-window -a -c "#{pane_current_path}" \; \
  bind -n C-h run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-h) || tmux select-pane -L" \; \
  bind -n C-j run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-j) || tmux select-pane -D" \; \
  bind -n C-k run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-k) || tmux select-pane -U" \; \
  bind -n C-l run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-l) || tmux select-pane -R" \; \
  bind C-v copy-mode \; \
  set -qg prefix C-a

set -qg window-status-separator-bg colour235
set -qg window-status-separator-fg colour235

#set -sg escape-time 0
#bind r source-file ~/.config/.tmux.conf \; display-message "Configuration reloaded"
bind , command-prompt 'rename-window %%'
bind . command-prompt 'rename-session %%'

# bind splits to open in the same working directory as the original
bind s split-window -c "#{pane_current_path}"
bind v split-window -h -c "#{pane_current_path}"
#bind c new-window -c "#{pane_current_path}"
bind j resize-pane -D 10
bind k resize-pane -U 10
bind l resize-pane -L 10
bind h resize-pane -R 10

# Move current pane left/right (swap with previous, swap with next)
bind-key -n M-i swap-pane -t -1
bind-key -n M-o swap-pane -t +1

# Move current window left/right (swap with previous, swap with next)
bind-key -n M-p swap-window -t -1
bind-key -n M-n swap-window -t +1

unbind -n C-v;
bind C-v copy-mode		# Activate copy mode on Prefx+C-v
#bind -n C-u copy-mode		# Activate copy mode on Prefx+C-v
bind p paste-buffer		# I don't care about regular Prefix+P binding, I have shift-left/shift-right for that

unbind -T copy-mode-vi Space     ;	bind -T copy-mode-vi v send-keys -X begin-selection
unbind -T copy-mode-vi Enter     ;	bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"
unbind -T copy-mode-vi C-v       ;	bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
unbind -T copy-mode-vi [         ;	bind -T copy-mode-vi [ send-keys -X begin-selection
unbind -T copy-mode-vi ]         ;	bind -T copy-mode-vi ] send-keys -X copy-selection

# Enable clipboard support on Mac
if-shell 'test "$(uname -s)" = Darwin && test -f "$(which reattach-to-user-namespace)"' 'set-option -g default-command "exec reattach-to-user-namespace -l zsh"'

